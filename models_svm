{"cells":[{"cell_type":"code","execution_count":129,"metadata":{"id":"EPKt8-ZmfLAj","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1642574851458,"user_tz":-480,"elapsed":2109,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}},"outputId":"8069a1db-011b-4eaa-f105-20c95bdfcd1b"},"outputs":[{"output_type":"stream","name":"stdout","text":["Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(\"/content/drive\", force_remount=True).\n"]}],"source":["\n","# mount to google driver in order to use data\n","from google.colab import drive\n","drive.mount('/content/drive')"]},{"cell_type":"code","execution_count":130,"metadata":{"id":"qUMQn-04fPML","executionInfo":{"status":"ok","timestamp":1642574854194,"user_tz":-480,"elapsed":290,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}}},"outputs":[],"source":["# import section\n","import pandas as pd\n","import seaborn as sns\n","import matplotlib.pyplot as plt\n","import numpy as  np\n","%matplotlib inline\n","\n","from sklearn.linear_model import LinearRegression\n","from sklearn.multiclass import OneVsRestClassifier"]},{"cell_type":"code","source":["def show_res_count(y_hat):\n","  dir = {i:0 for i in range(6)}\n","  for i in y_hat:\n","    dir[i]+=1\n","  for i in dir:\n","    print(i,dir[i])"],"metadata":{"id":"DWGSWOWyIx2M","executionInfo":{"status":"ok","timestamp":1642565686303,"user_tz":-480,"elapsed":4,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}}},"execution_count":2,"outputs":[]},{"cell_type":"code","execution_count":18,"metadata":{"id":"lz94_If_0Y9d","executionInfo":{"status":"ok","timestamp":1642566265174,"user_tz":-480,"elapsed":426,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}}},"outputs":[],"source":["#Use satisfaction score , try to predict the answer\n","#Merge two dataframes and replace answer string to code\n","\n","result = pd.merge(Train_IDs, status, on=\"Customer ID\")\n","temp = satisfaction.fillna(2.5)\n","result = pd.merge(result , temp , on = \"Customer ID\")\n","replace_dir = {\"Churn Category\" : {\"No Churn\":0 , \"Competitor\":1 , \"Dissatisfaction\":2 , \"Attitude\" : 3 , \"Price\" : 4 , \"Other\" : 5}}\n","result = result.replace(replace_dir)\n","X = result[\"Satisfaction Score\"]\n","Y = result['Churn Category']"]},{"cell_type":"code","execution_count":20,"metadata":{"id":"XRO8X44Z8ceH","executionInfo":{"status":"ok","timestamp":1642566265175,"user_tz":-480,"elapsed":3,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}}},"outputs":[],"source":["num_data = [\n"," 'Total Revenue',\n"," 'Tenure in Months',\n"," 'Number of Referrals',\n"," 'Age',\n"," 'Number of Dependents',\n"," 'Longitude',\n"," 'Avg Monthly GB Download',\n"," 'Total Refunds',\n"," 'Total Long Distance Charges',\n"," 'Latitude',\n","\n"," 'Avg Monthly Long Distance Charges',\n"," 'Monthly Charge',\n"," 'Total Charges',\n"," 'Total Extra Data Charges',\n","\n","]"]},{"cell_type":"code","execution_count":138,"metadata":{"id":"khw1kZJYgtG6","executionInfo":{"status":"ok","timestamp":1642575239488,"user_tz":-480,"elapsed":25,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}}},"outputs":[],"source":["Test_IDs = pd.read_csv('/content/drive/MyDrive/HTML final project/Test_IDs.csv')\n","Train_IDs = pd.read_csv('/content/drive/MyDrive/HTML final project/Train_IDs.csv')\n","demographics = pd.read_csv('/content/drive/MyDrive/HTML final project/demographics.csv')\n","location = pd.read_csv('/content/drive/MyDrive/HTML final project/location.csv')\n","population = pd.read_csv('/content/drive/MyDrive/HTML final project/population.csv')\n","sample_submission = pd.read_csv('/content/drive/MyDrive/HTML final project/sample_submission.csv')\n","satisfaction = pd.read_csv('/content/drive/MyDrive/HTML final project/satisfaction.csv')\n","services = pd.read_csv('/content/drive/MyDrive/HTML final project/services.csv')\n","status = pd.read_csv('/content/drive/MyDrive/HTML final project/status.csv')\n","data = pd.read_csv('/content/drive/MyDrive/HTML final project/all_impute_data.csv')"]},{"cell_type":"code","execution_count":139,"metadata":{"id":"cQ1cZZOwyVJ9","executionInfo":{"status":"ok","timestamp":1642575239491,"user_tz":-480,"elapsed":22,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}}},"outputs":[],"source":["\n","all = [\n","  'Customer ID',\n","  'Churn Category',\n","  'Count',\n","  'Gender',\n","  'Age',\n","  'Under 30',\n","  'Senior Citizen',\n","  'Married',\n","  'Dependents',\n","  'Number of Dependents',\n","  'City',\n","  'Latitude',\n","  'Longitude',\n","  'Referred a Friend',\n","  'Number of Referrals',\n","  'Tenure in Months',\n","  'Offer',\n","  'Phone Service',\n","  'Avg Monthly Long Distance Charges',\n","  'Multiple Lines',\n","  'Internet Service',\n","  'Internet Type',\n","  'Avg Monthly GB Download',\n","  'Online Security',\n","  'Online Backup',\n","  'Device Protection Plan',\n","  'Premium Tech Support',\n","  'Streaming TV',\n","  'Streaming Movies',\n","  'Streaming Music',\n","  'Unlimited Data',\n","  'Contract',\n","  'Paperless Billing',\n","  'Payment Method',\n","  'Monthly Charge',\n","  'Total Charges',\n","  'Total Refunds',\n","  'Total Extra Data Charges',\n","  'Total Long Distance Charges',\n","  'Total Revenue',\n","  'Satisfaction Score',\n","]\n","human_knowledge  = data[all]\n","\n","features = all[2:] + [\"pro\", \"entertainment\"]\n","human_knowledge  = data[all]\n","human_knowledge = human_knowledge.copy()"]},{"cell_type":"markdown","source":["# Encoding"],"metadata":{"id":"hpdisz5KY2RP"}},{"cell_type":"code","source":["data"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":731},"id":"8LeSYq3T_fiA","executionInfo":{"status":"ok","timestamp":1642575241893,"user_tz":-480,"elapsed":14,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}},"outputId":"7952289c-c5e2-40b8-ba50-d4027cb8ddc7"},"execution_count":140,"outputs":[{"output_type":"execute_result","data":{"text/html":["\n","  <div id=\"df-4960a64a-7288-4c27-9ab9-6f00806ec01a\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>Unnamed: 0</th>\n","      <th>Customer ID</th>\n","      <th>Count</th>\n","      <th>Gender</th>\n","      <th>Age</th>\n","      <th>Under 30</th>\n","      <th>Senior Citizen</th>\n","      <th>Married</th>\n","      <th>Dependents</th>\n","      <th>Number of Dependents</th>\n","      <th>Country</th>\n","      <th>State</th>\n","      <th>City</th>\n","      <th>Zip Code</th>\n","      <th>Latitude</th>\n","      <th>Longitude</th>\n","      <th>ID</th>\n","      <th>Population</th>\n","      <th>Quarter</th>\n","      <th>Referred a Friend</th>\n","      <th>Number of Referrals</th>\n","      <th>Tenure in Months</th>\n","      <th>Offer</th>\n","      <th>Phone Service</th>\n","      <th>Avg Monthly Long Distance Charges</th>\n","      <th>Multiple Lines</th>\n","      <th>Internet Service</th>\n","      <th>Internet Type</th>\n","      <th>Avg Monthly GB Download</th>\n","      <th>Online Security</th>\n","      <th>Online Backup</th>\n","      <th>Device Protection Plan</th>\n","      <th>Premium Tech Support</th>\n","      <th>Streaming TV</th>\n","      <th>Streaming Movies</th>\n","      <th>Streaming Music</th>\n","      <th>Unlimited Data</th>\n","      <th>Contract</th>\n","      <th>Paperless Billing</th>\n","      <th>Payment Method</th>\n","      <th>Monthly Charge</th>\n","      <th>Total Charges</th>\n","      <th>Total Refunds</th>\n","      <th>Total Extra Data Charges</th>\n","      <th>Total Long Distance Charges</th>\n","      <th>Total Revenue</th>\n","      <th>Satisfaction Score</th>\n","      <th>Churn Category</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>0</td>\n","      <td>1746-TGTWV</td>\n","      <td>1.00000</td>\n","      <td>1.000000</td>\n","      <td>78.0</td>\n","      <td>0.0</td>\n","      <td>1.0</td>\n","      <td>0.000000</td>\n","      <td>0.000000</td>\n","      <td>0.0</td>\n","      <td>0.0</td>\n","      <td>0.0</td>\n","      <td>550.0</td>\n","      <td>90022.000000</td>\n","      <td>34.023810</td>\n","      <td>-118.156582</td>\n","      <td>21.000000</td>\n","      <td>68701.000000</td>\n","      <td>1.0</td>\n","      <td>0.000000</td>\n","      <td>0.0</td>\n","      <td>1.0</td>\n","      <td>0.0</td>\n","      <td>0.000000</td>\n","      <td>0.00</td>\n","      <td>0.000000</td>\n","      <td>1.0</td>\n","      <td>1.000000</td>\n","      <td>8.000000</td>\n","      <td>0.000000</td>\n","      <td>0.000000</td>\n","      <td>0.007881</td>\n","      <td>0.000000</td>\n","      <td>0.000000</td>\n","      <td>1.0</td>\n","      <td>0.000000</td>\n","      <td>0.0</td>\n","      <td>0.000000</td>\n","      <td>1.00000</td>\n","      <td>0.000000</td>\n","      <td>39.65</td>\n","      <td>54.442938</td>\n","      <td>0.000000</td>\n","      <td>20.0</td>\n","      <td>0.00</td>\n","      <td>59.65</td>\n","      <td>NaN</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>1</td>\n","      <td>8499-BRXTD</td>\n","      <td>1.00000</td>\n","      <td>0.000000</td>\n","      <td>74.0</td>\n","      <td>0.0</td>\n","      <td>1.0</td>\n","      <td>1.000000</td>\n","      <td>0.302566</td>\n","      <td>1.0</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>1.0</td>\n","      <td>1.000000</td>\n","      <td>1.0</td>\n","      <td>8.0</td>\n","      <td>5.0</td>\n","      <td>0.195882</td>\n","      <td>48.85</td>\n","      <td>1.000000</td>\n","      <td>1.0</td>\n","      <td>2.000000</td>\n","      <td>17.000000</td>\n","      <td>0.000000</td>\n","      <td>1.000000</td>\n","      <td>0.000000</td>\n","      <td>0.000000</td>\n","      <td>0.000000</td>\n","      <td>0.0</td>\n","      <td>0.000000</td>\n","      <td>1.0</td>\n","      <td>0.000000</td>\n","      <td>1.00000</td>\n","      <td>0.092834</td>\n","      <td>80.65</td>\n","      <td>633.300000</td>\n","      <td>0.000000</td>\n","      <td>0.0</td>\n","      <td>390.80</td>\n","      <td>1024.10</td>\n","      <td>3.0</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>2</td>\n","      <td>2041-JIJCI</td>\n","      <td>1.00000</td>\n","      <td>1.000000</td>\n","      <td>71.0</td>\n","      <td>0.0</td>\n","      <td>1.0</td>\n","      <td>0.000000</td>\n","      <td>1.000000</td>\n","      <td>3.0</td>\n","      <td>0.0</td>\n","      <td>0.0</td>\n","      <td>550.0</td>\n","      <td>141.275499</td>\n","      <td>34.108833</td>\n","      <td>-118.229715</td>\n","      <td>1.178314</td>\n","      <td>35.593571</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>3</td>\n","      <td>5832-EXGTT</td>\n","      <td>1.00000</td>\n","      <td>0.000000</td>\n","      <td>78.0</td>\n","      <td>0.0</td>\n","      <td>1.0</td>\n","      <td>1.000000</td>\n","      <td>1.000000</td>\n","      <td>1.0</td>\n","      <td>0.0</td>\n","      <td>0.0</td>\n","      <td>445.0</td>\n","      <td>90303.000000</td>\n","      <td>33.936291</td>\n","      <td>-118.332639</td>\n","      <td>100.000000</td>\n","      <td>27778.000000</td>\n","      <td>1.0</td>\n","      <td>1.000000</td>\n","      <td>1.0</td>\n","      <td>25.0</td>\n","      <td>3.0</td>\n","      <td>0.451410</td>\n","      <td>19.76</td>\n","      <td>0.000000</td>\n","      <td>1.0</td>\n","      <td>0.754577</td>\n","      <td>12.000000</td>\n","      <td>0.000000</td>\n","      <td>1.000000</td>\n","      <td>1.000000</td>\n","      <td>0.268719</td>\n","      <td>1.000000</td>\n","      <td>1.0</td>\n","      <td>0.313729</td>\n","      <td>1.0</td>\n","      <td>0.000000</td>\n","      <td>1.00000</td>\n","      <td>0.000000</td>\n","      <td>98.50</td>\n","      <td>2514.500000</td>\n","      <td>1.053030</td>\n","      <td>0.0</td>\n","      <td>494.00</td>\n","      <td>2995.07</td>\n","      <td>2.0</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>4</td>\n","      <td>8350-NYMVI</td>\n","      <td>1.49399</td>\n","      <td>0.763107</td>\n","      <td>80.0</td>\n","      <td>0.0</td>\n","      <td>1.0</td>\n","      <td>0.729999</td>\n","      <td>1.000000</td>\n","      <td>1.0</td>\n","      <td>0.0</td>\n","      <td>0.0</td>\n","      <td>1067.0</td>\n","      <td>90602.000000</td>\n","      <td>34.159380</td>\n","      <td>-118.020188</td>\n","      <td>114.000000</td>\n","      <td>26265.000000</td>\n","      <td>1.0</td>\n","      <td>1.000000</td>\n","      <td>1.0</td>\n","      <td>37.0</td>\n","      <td>3.0</td>\n","      <td>1.000000</td>\n","      <td>6.33</td>\n","      <td>0.362891</td>\n","      <td>1.0</td>\n","      <td>2.000000</td>\n","      <td>15.422997</td>\n","      <td>0.000000</td>\n","      <td>0.376271</td>\n","      <td>0.392631</td>\n","      <td>0.000000</td>\n","      <td>0.420688</td>\n","      <td>0.0</td>\n","      <td>0.000000</td>\n","      <td>1.0</td>\n","      <td>0.000000</td>\n","      <td>1.00000</td>\n","      <td>0.000000</td>\n","      <td>76.50</td>\n","      <td>2868.150000</td>\n","      <td>0.000000</td>\n","      <td>0.0</td>\n","      <td>234.21</td>\n","      <td>3102.36</td>\n","      <td>2.0</td>\n","      <td>4</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>4221</th>\n","      <td>4221</td>\n","      <td>7817-BOQPW</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>1.0</td>\n","      <td>0.005947</td>\n","      <td>0.0</td>\n","      <td>1.0</td>\n","      <td>0.0</td>\n","      <td>1.000000</td>\n","      <td>29.19</td>\n","      <td>0.000000</td>\n","      <td>0.0</td>\n","      <td>3.000000</td>\n","      <td>0.000000</td>\n","      <td>0.002147</td>\n","      <td>0.000000</td>\n","      <td>0.000000</td>\n","      <td>0.000000</td>\n","      <td>0.000000</td>\n","      <td>0.0</td>\n","      <td>0.000000</td>\n","      <td>0.0</td>\n","      <td>0.012337</td>\n","      <td>0.00000</td>\n","      <td>1.000000</td>\n","      <td>20.30</td>\n","      <td>20.300000</td>\n","      <td>0.020664</td>\n","      <td>0.0</td>\n","      <td>29.19</td>\n","      <td>49.49</td>\n","      <td>5.0</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>4222</th>\n","      <td>4222</td>\n","      <td>4767-HZZHQ</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>1.0</td>\n","      <td>0.000000</td>\n","      <td>0.0</td>\n","      <td>34.0</td>\n","      <td>0.0</td>\n","      <td>1.000000</td>\n","      <td>45.56</td>\n","      <td>0.000000</td>\n","      <td>1.0</td>\n","      <td>1.000000</td>\n","      <td>7.000000</td>\n","      <td>0.209468</td>\n","      <td>1.000000</td>\n","      <td>0.000000</td>\n","      <td>0.000000</td>\n","      <td>0.000000</td>\n","      <td>1.0</td>\n","      <td>1.000000</td>\n","      <td>1.0</td>\n","      <td>0.800638</td>\n","      <td>0.36043</td>\n","      <td>0.000000</td>\n","      <td>64.35</td>\n","      <td>2053.050000</td>\n","      <td>46.390000</td>\n","      <td>0.0</td>\n","      <td>1549.04</td>\n","      <td>3555.70</td>\n","      <td>3.0</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>4223</th>\n","      <td>4223</td>\n","      <td>6981-TDRFT</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>4.0</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>4224</th>\n","      <td>4224</td>\n","      <td>3094-JOJAI</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>5.0</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>4225</th>\n","      <td>4225</td>\n","      <td>9079-YEXQJ</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>4.0</td>\n","      <td>0</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>4226 rows Ã— 48 columns</p>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-4960a64a-7288-4c27-9ab9-6f00806ec01a')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-4960a64a-7288-4c27-9ab9-6f00806ec01a button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-4960a64a-7288-4c27-9ab9-6f00806ec01a');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "],"text/plain":["      Unnamed: 0 Customer ID  ...  Satisfaction Score  Churn Category\n","0              0  1746-TGTWV  ...                 NaN               1\n","1              1  8499-BRXTD  ...                 3.0               1\n","2              2  2041-JIJCI  ...                 NaN               1\n","3              3  5832-EXGTT  ...                 2.0               2\n","4              4  8350-NYMVI  ...                 2.0               4\n","...          ...         ...  ...                 ...             ...\n","4221        4221  7817-BOQPW  ...                 5.0               0\n","4222        4222  4767-HZZHQ  ...                 3.0               0\n","4223        4223  6981-TDRFT  ...                 4.0               0\n","4224        4224  3094-JOJAI  ...                 5.0               0\n","4225        4225  9079-YEXQJ  ...                 4.0               0\n","\n","[4226 rows x 48 columns]"]},"metadata":{},"execution_count":140}]},{"cell_type":"code","execution_count":143,"metadata":{"id":"Hus-CmNLHZCu","executionInfo":{"status":"ok","timestamp":1642575264127,"user_tz":-480,"elapsed":7720,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}}},"outputs":[],"source":["human_knowledge[\"entertainment\"] = np.zeros(len(human_knowledge))\n","human_knowledge[\"pro\"] = np.zeros(len(human_knowledge))\n","# service\n","\n","data[\"Streaming TV\"] = data[\"Streaming TV\"].fillna(0)\n","data[\"Streaming Movies\"] = data[\"Streaming Movies\"].fillna(0)\n","data[\"Streaming Music\"] = data[\"Streaming Music\"].fillna(0)\n","\n","for i in [\"Online Security\",\t\"Online Backup\"\t,\"Device Protection Plan\",\t\"Premium Tech Support\"]:\n","  data[i] = data[i].fillna(0)\n","\n","\n","\n","for index, row in data.iterrows():\n","  human_knowledge.loc[index,\"entertainment\"] = row[\"Streaming TV\"]*4 + row[\"Streaming Movies\"]*2 + row[\"Streaming Music\"]\n","  count = 1\n","  for i in [\"Online Security\",\t\"Online Backup\"\t,\"Device Protection Plan\",\t\"Premium Tech Support\"]:\n","    human_knowledge.loc[index,\"pro\"] +=  row[i]*count\n","    count *= 2\n","\n","human_knowledge = human_knowledge.dropna(subset=[\"Churn Category\"])\n","human_knowledge = human_knowledge.dropna(thresh=3)\n","\n","\"\"\"\n","# z-score \n","for col in human_knowledge:\n","  if col != \"Customer ID\" and col != \"Churn Category\" and col in num_data:\n","    human_knowledge[col] = (human_knowledge[col] - human_knowledge[col].mean())/human_knowledge[col].std()\n","\"\"\"\n","\"\"\"\n","for i in human_knowledge:\n","  if i != \"Customer ID\" and i != \"Churn Category\" :\n","   # if i in num_data:\n","   #   human_knowledge[i] = human_knowledge[i].fillna(3)\n","    print(i)\n","   # else:\n","    #human_knowledge[i] = human_knowledge[i].fillna(human_knowledge[i].median())\n","    #human_knowledge[i] = human_knowledge[i].fillna(human_knowledge[i].mean())\n","    #human_knowledge[i] = human_knowledge[i].fillna(human_knowledge[i].mode()[0])\n","    #human_knowledge[i] = human_knowledge[i].fillna(3)\n","    \n","    human_knowledge[i] = KNN(k=3).fit_transform(human_knowledge[i].to_numpy().reshape(1,-1))\n","\"\"\"\n","#!pip install fancyimpute\n","from fancyimpute import KNN, NuclearNormMinimization, SoftImpute, BiScaler\n"]},{"cell_type":"code","source":["for i in human_knowledge:\n","  if i != \"Customer ID\" and i != \"Churn Category\" :\n","   # if i in num_data:\n","   #   human_knowledge[i] = human_knowledge[i].fillna(3)\n","    print(i)\n","   # else:\n","    #human_knowledge[i] = human_knowledge[i].fillna(human_knowledge[i].median())\n","    #human_knowledge[i] = human_knowledge[i].fillna(human_knowledge[i].mean())\n","    #human_knowledge[i] = human_knowledge[i].fillna(human_knowledge[i].mode()[0])\n","    #human_knowledge[i] = human_knowledge[i].fillna(3)\n","    \n"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"g5Fu8lIW96uk","executionInfo":{"status":"ok","timestamp":1642575241894,"user_tz":-480,"elapsed":10,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}},"outputId":"c23007c2-4b55-444a-eb53-0ba6a5ba9dc4"},"execution_count":141,"outputs":[{"output_type":"stream","name":"stdout","text":["Count\n","Gender\n","Age\n","Under 30\n","Senior Citizen\n","Married\n","Dependents\n","Number of Dependents\n","City\n","Latitude\n","Longitude\n","Referred a Friend\n","Number of Referrals\n","Tenure in Months\n","Offer\n","Phone Service\n","Avg Monthly Long Distance Charges\n","Multiple Lines\n","Internet Service\n","Internet Type\n","Avg Monthly GB Download\n","Online Security\n","Online Backup\n","Device Protection Plan\n","Premium Tech Support\n","Streaming TV\n","Streaming Movies\n","Streaming Music\n","Unlimited Data\n","Contract\n","Paperless Billing\n","Payment Method\n","Monthly Charge\n","Total Charges\n","Total Refunds\n","Total Extra Data Charges\n","Total Long Distance Charges\n","Total Revenue\n","Satisfaction Score\n"]}]},{"cell_type":"code","source":[""],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"WBFKpb7W-TuB","executionInfo":{"status":"ok","timestamp":1642572891368,"user_tz":-480,"elapsed":289,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}},"outputId":"68801d88-cd92-43a2-9a20-9ccd151ede4b"},"execution_count":83,"outputs":[{"output_type":"stream","name":"stdout","text":["Imputing row 1/1 with 0 missing, elapsed time: 0.000\n"]},{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.7/dist-packages/fancyimpute/solver.py:55: UserWarning: Input matrix is not missing any values\n","  warnings.warn(\"Input matrix is not missing any values\")\n"]},{"output_type":"execute_result","data":{"text/plain":["array([[1., 1., 1., ..., 1., 1., 1.]])"]},"metadata":{},"execution_count":83}]},{"cell_type":"code","execution_count":144,"metadata":{"id":"22yrZKq07VqZ","executionInfo":{"status":"ok","timestamp":1642575272689,"user_tz":-480,"elapsed":2844,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}},"colab":{"base_uri":"https://localhost:8080/"},"outputId":"a6c052e0-47cd-4f08-fbaa-dc41bd4ca786"},"outputs":[{"output_type":"stream","name":"stdout","text":["[SoftImpute] Max Singular Value of X_init = 318618.414616\n","[SoftImpute] Iter 1: observed MAE=10.429201 rank=3\n","[SoftImpute] Iter 2: observed MAE=10.433016 rank=3\n","[SoftImpute] Iter 3: observed MAE=10.440636 rank=3\n","[SoftImpute] Iter 4: observed MAE=10.445382 rank=3\n","[SoftImpute] Iter 5: observed MAE=10.448445 rank=3\n","[SoftImpute] Iter 6: observed MAE=10.450371 rank=3\n","[SoftImpute] Iter 7: observed MAE=10.451579 rank=3\n","[SoftImpute] Iter 8: observed MAE=10.452222 rank=3\n","[SoftImpute] Iter 9: observed MAE=10.452528 rank=3\n","[SoftImpute] Iter 10: observed MAE=10.452659 rank=3\n","[SoftImpute] Iter 11: observed MAE=10.452698 rank=3\n","[SoftImpute] Iter 12: observed MAE=10.452680 rank=3\n","[SoftImpute] Iter 13: observed MAE=10.452646 rank=3\n","[SoftImpute] Iter 14: observed MAE=10.452603 rank=3\n","[SoftImpute] Iter 15: observed MAE=10.452549 rank=3\n","[SoftImpute] Iter 16: observed MAE=10.452498 rank=3\n","[SoftImpute] Iter 17: observed MAE=10.452456 rank=3\n","[SoftImpute] Iter 18: observed MAE=10.452426 rank=3\n","[SoftImpute] Iter 19: observed MAE=10.452404 rank=3\n","[SoftImpute] Iter 20: observed MAE=10.452390 rank=3\n","[SoftImpute] Iter 21: observed MAE=10.452382 rank=3\n","[SoftImpute] Iter 22: observed MAE=10.452380 rank=3\n","[SoftImpute] Iter 23: observed MAE=10.452386 rank=3\n","[SoftImpute] Iter 24: observed MAE=10.452398 rank=3\n","[SoftImpute] Iter 25: observed MAE=10.452413 rank=3\n","[SoftImpute] Iter 26: observed MAE=10.452430 rank=3\n","[SoftImpute] Iter 27: observed MAE=10.452449 rank=3\n","[SoftImpute] Iter 28: observed MAE=10.452471 rank=3\n","[SoftImpute] Iter 29: observed MAE=10.452493 rank=3\n","[SoftImpute] Iter 30: observed MAE=10.452517 rank=3\n","[SoftImpute] Iter 31: observed MAE=10.452541 rank=3\n","[SoftImpute] Iter 32: observed MAE=10.452565 rank=3\n","[SoftImpute] Iter 33: observed MAE=10.452589 rank=3\n","[SoftImpute] Iter 34: observed MAE=10.452613 rank=3\n","[SoftImpute] Iter 35: observed MAE=10.452637 rank=3\n","[SoftImpute] Iter 36: observed MAE=10.452661 rank=3\n","[SoftImpute] Iter 37: observed MAE=10.452685 rank=3\n","[SoftImpute] Iter 38: observed MAE=10.452709 rank=3\n","[SoftImpute] Iter 39: observed MAE=10.452732 rank=3\n","[SoftImpute] Iter 40: observed MAE=10.452754 rank=3\n","[SoftImpute] Iter 41: observed MAE=10.452776 rank=3\n","[SoftImpute] Iter 42: observed MAE=10.452798 rank=3\n","[SoftImpute] Iter 43: observed MAE=10.452818 rank=3\n","[SoftImpute] Iter 44: observed MAE=10.452839 rank=3\n","[SoftImpute] Iter 45: observed MAE=10.452859 rank=3\n","[SoftImpute] Iter 46: observed MAE=10.452879 rank=3\n","[SoftImpute] Iter 47: observed MAE=10.452898 rank=3\n","[SoftImpute] Iter 48: observed MAE=10.452917 rank=3\n","[SoftImpute] Iter 49: observed MAE=10.452936 rank=3\n","[SoftImpute] Iter 50: observed MAE=10.452954 rank=3\n","[SoftImpute] Iter 51: observed MAE=10.452971 rank=3\n","[SoftImpute] Iter 52: observed MAE=10.452988 rank=3\n","[SoftImpute] Iter 53: observed MAE=10.453005 rank=3\n","[SoftImpute] Iter 54: observed MAE=10.453021 rank=3\n","[SoftImpute] Iter 55: observed MAE=10.453036 rank=3\n","[SoftImpute] Iter 56: observed MAE=10.453051 rank=3\n","[SoftImpute] Iter 57: observed MAE=10.453065 rank=3\n","[SoftImpute] Iter 58: observed MAE=10.453079 rank=3\n","[SoftImpute] Iter 59: observed MAE=10.453093 rank=3\n","[SoftImpute] Iter 60: observed MAE=10.453106 rank=3\n","[SoftImpute] Iter 61: observed MAE=10.453120 rank=3\n","[SoftImpute] Iter 62: observed MAE=10.453132 rank=3\n","[SoftImpute] Iter 63: observed MAE=10.453145 rank=3\n","[SoftImpute] Iter 64: observed MAE=10.453157 rank=3\n","[SoftImpute] Iter 65: observed MAE=10.453169 rank=3\n","[SoftImpute] Iter 66: observed MAE=10.453181 rank=3\n","[SoftImpute] Iter 67: observed MAE=10.453192 rank=3\n","[SoftImpute] Iter 68: observed MAE=10.453204 rank=3\n","[SoftImpute] Iter 69: observed MAE=10.453215 rank=3\n","[SoftImpute] Iter 70: observed MAE=10.453225 rank=3\n","[SoftImpute] Iter 71: observed MAE=10.453236 rank=3\n","[SoftImpute] Iter 72: observed MAE=10.453246 rank=3\n","[SoftImpute] Iter 73: observed MAE=10.453256 rank=3\n","[SoftImpute] Iter 74: observed MAE=10.453265 rank=3\n","[SoftImpute] Iter 75: observed MAE=10.453275 rank=3\n","[SoftImpute] Iter 76: observed MAE=10.453284 rank=3\n","[SoftImpute] Iter 77: observed MAE=10.453293 rank=3\n","[SoftImpute] Iter 78: observed MAE=10.453302 rank=3\n","[SoftImpute] Iter 79: observed MAE=10.453311 rank=3\n","[SoftImpute] Iter 80: observed MAE=10.453319 rank=3\n","[SoftImpute] Iter 81: observed MAE=10.453328 rank=3\n","[SoftImpute] Iter 82: observed MAE=10.453336 rank=3\n","[SoftImpute] Iter 83: observed MAE=10.453344 rank=3\n","[SoftImpute] Iter 84: observed MAE=10.453352 rank=3\n","[SoftImpute] Iter 85: observed MAE=10.453359 rank=3\n","[SoftImpute] Iter 86: observed MAE=10.453367 rank=3\n","[SoftImpute] Iter 87: observed MAE=10.453374 rank=3\n","[SoftImpute] Iter 88: observed MAE=10.453381 rank=3\n","[SoftImpute] Iter 89: observed MAE=10.453388 rank=3\n","[SoftImpute] Iter 90: observed MAE=10.453395 rank=3\n","[SoftImpute] Iter 91: observed MAE=10.453402 rank=3\n","[SoftImpute] Iter 92: observed MAE=10.453408 rank=3\n","[SoftImpute] Iter 93: observed MAE=10.453415 rank=3\n","[SoftImpute] Iter 94: observed MAE=10.453421 rank=3\n","[SoftImpute] Iter 95: observed MAE=10.453427 rank=3\n","[SoftImpute] Iter 96: observed MAE=10.453433 rank=3\n","[SoftImpute] Iter 97: observed MAE=10.453438 rank=3\n","[SoftImpute] Iter 98: observed MAE=10.453444 rank=3\n","[SoftImpute] Iter 99: observed MAE=10.453449 rank=3\n","[SoftImpute] Iter 100: observed MAE=10.453454 rank=3\n","[SoftImpute] Stopped after iteration 100 for lambda=6372.368292\n"]},{"output_type":"execute_result","data":{"text/plain":["1.805081396226757"]},"metadata":{},"execution_count":144}],"source":["from sklearn.model_selection import cross_val_score\n","import numpy as np\n","import matplotlib.pyplot as plt\n","from sklearn.datasets import load_iris\n","from sklearn.feature_selection import SelectPercentile, chi2\n","from sklearn.model_selection import cross_val_score\n","from sklearn.pipeline import Pipeline\n","from sklearn.preprocessing import StandardScaler\n","from sklearn.svm import SVC\n","from sklearn.multiclass import OneVsOneClassifier\n","from sklearn.neighbors import KNeighborsClassifier\n","from sklearn.model_selection import cross_val_score\n","# for i in [ i for i in range(500,2000,100)]:\n","#   print(i)\n","# clf = svm.SVC(decision_function_shape='ovo')\n","# clf = svm.SVC(kernel='linear')\n","# clf = Pipeline(\n","#     [\n","#         # (\"anova\", SelectPercentile(chi2)),\n","#         (\"scaler\", StandardScaler()),\n","#         (\"svc\", SVC(gamma=\"auto\")),\n","#     ]\n","# )\n","softImpute = SoftImpute()\n","#clf = SVC(kernel='linear', C=1, decision_function_shape='ovr')\n","clf = KNeighborsClassifier(n_neighbors=3)\n","X = softImpute.fit_transform(human_knowledge[features])\n","\n","clf.fit(X, human_knowledge[\"Churn Category\"])\n","sum(cross_val_score(clf, X,human_knowledge[\"Churn Category\"], cv=10, scoring='f1_macro'))"]},{"cell_type":"code","source":["sum(np.isnan(X))"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"nfwJP2tzBA2h","executionInfo":{"status":"ok","timestamp":1642573652860,"user_tz":-480,"elapsed":283,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}},"outputId":"037639c8-6d51-43a9-a8a4-271cab52eeaf"},"execution_count":111,"outputs":[{"output_type":"execute_result","data":{"text/plain":["array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n","       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])"]},"metadata":{},"execution_count":111}]},{"cell_type":"code","source":["1.412908208518382"],"metadata":{"id":"OM5tU8wKnaTz"},"execution_count":null,"outputs":[]},{"cell_type":"code","execution_count":33,"metadata":{"id":"ZJHUaljIJSQj","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1642566708846,"user_tz":-480,"elapsed":3210,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}},"outputId":"252b5cac-7071-47b7-df4b-b913a7d10f44"},"outputs":[{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.7/dist-packages/pandas/core/series.py:4582: SettingWithCopyWarning: \n","A value is trying to be set on a copy of a slice from a DataFrame\n","\n","See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n","  method=method,\n","/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:67: SettingWithCopyWarning: \n","A value is trying to be set on a copy of a slice from a DataFrame.\n","Try using .loc[row_indexer,col_indexer] = value instead\n","\n","See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n"]}],"source":["test = pd.merge(Test_IDs[\"Customer ID\"].to_frame(), satisfaction , on = \"Customer ID\" , how ='left')\n","test = pd.merge(test ,services ,on = \"Customer ID\" , how ='left')\n","test = pd.merge(test ,demographics,on = \"Customer ID\" , how ='left')\n","test = pd.merge(test ,location,on = \"Customer ID\" , how ='left')\n","\n","test['Streaming TV'].replace(['No', 'Yes'], [0, 1], inplace = True)\n","test['Streaming Movies'].replace(['No', 'Yes'], [0, 1], inplace = True)\n","test['Streaming Music'].replace(['No', 'Yes'], [0, 1], inplace = True)\n","test['Offer'].replace(sorted(services['Offer'].loc[~services['Offer'].isnull()].unique()),\n","                          list(range(len(services['Offer'].loc[~services['Offer'].isnull()].unique()))), inplace = True)\n","test['Payment Method'].replace(sorted(services['Payment Method'].loc[~services['Payment Method'].isnull()].unique()),\n","                         list(range(len(services['Payment Method'].loc[~services['Payment Method'].isnull()].unique()))), inplace = True)\n","test['Online Security'].replace(['No', 'Yes'], [0, 1], inplace = True)\n","test['Online Backup'].replace(['No', 'Yes'], [0, 1], inplace = True)\n","test['Device Protection Plan'].replace(['No', 'Yes'], [0, 1], inplace = True)\n","test['Premium Tech Support'].replace(['No', 'Yes'], [0, 1], inplace = True)\n","test['Married'].replace(['No', 'Yes'], [0, 1],inplace = True)\n","test['Dependents'].replace(['No', 'Yes'], [0, 1],inplace = True)\n","test[\"Streaming TV\"] = test[\"Streaming TV\"].fillna(0)\n","test[\"Streaming Movies\"] = test[\"Streaming Movies\"].fillna(0)\n","test[\"Streaming Music\"] = test[\"Streaming Music\"].fillna(0)\n","test['Senior Citizen'].replace(['No', 'Yes'], [0, 1],inplace = True)\n","test['Gender'].replace(['Female', 'Male'], [0, 1],inplace = True)\n","test['Under 30'].replace(['No', 'Yes'], [0, 1],inplace = True)\n","for i in [\"Online Security\",\t\"Online Backup\"\t,\"Device Protection Plan\",\t\"Premium Tech Support\"]:\n","  test[i] = test[i].fillna(0)\n","#test['Device Protection Plan'].replace(['No', 'Yes'], [0, 1], inplace = True)\n","#test['Premium Tech Support'].replace(['No', 'Yes'], [0, 1], inplace = True)\n","test['Unlimited Data'].replace(['No', 'Yes'], [0, 1], inplace = True)\n","test['Paperless Billing'].replace(['No', 'Yes'], [0, 1], inplace = True)\n","test['Contract'].replace(sorted(services['Contract'].loc[~services['Contract'].isnull()].unique()),\n","                         list(range(len(services['Contract'].loc[~services['Contract'].isnull()].unique()))), inplace = True)\n","#test['Offer'].replace(sorted(services['Offer'].loc[~services['Offer'].isnull()].unique()),\n"," #                        list(range(len(services['Offer'].loc[~services['Offer'].isnull()].unique()))), inplace = True)\n","\n","test['Referred a Friend'].replace(['No', 'Yes'], [0, 1], inplace = True)\n","test['Phone Service'].replace(['No', 'Yes'], [0, 1], inplace = True)\n","test['Multiple Lines'].replace(['No', 'Yes'], [0, 1], inplace = True)\n","#test['Internet Service'].replace(['No', 'Yes'], [0, 1], inplace = True)\n","test['Internet Type'].replace(sorted(services['Internet Type'].loc[~services['Internet Type'].isnull()].unique()),\n","                         list(range(len(services['Internet Type'].loc[~services['Internet Type'].isnull()].unique()))), inplace = True)\n","test[\"pro\"] = np.zeros(len(test))\n","test[\"entertainment\"] = np.zeros(len(test))\n","for index, row in test.iterrows():\n","  test.loc[index , \"entertainment\"] = row[\"Streaming TV\"]*4 + row[\"Streaming Movies\"]*2 + row[\"Streaming Music\"]\n","  count = 1\n","  for i in [\"Online Security\",\t\"Online Backup\"\t,\"Device Protection Plan\",\t\"Premium Tech Support\"]:\n","    test.loc[index , \"pro\"] +=  row[i]*count\n","    count *= 2\n","test['Internet Service'].replace(['No', 'Yes'], [0, 1], inplace = True)\n","test = test[features]\n","test['City'].replace(sorted(location['City'].loc[~location['City'].isnull()].unique()),\n","                        list(range(len(location['City'].loc[~location['City'].isnull()].unique()))), inplace = True)\n","\n","\"\"\"\n","for col in test:\n","  if col in num_data:\n","    test[col] = (test[col] - test[col].mean())/test[col].std()\n","\"\"\"\n","for i in test:\n","  if i != \"Customer ID\" and i != \"Churn Category\":\n","    #if i in num_data:\n","    #  test[i] = test[i].fillna(3)\n","    #else:\n","      #test[i] = test[i].fillna(test[i].median())\n","      #test[i] = test[i].fillna(test[i].mean())\n","      test[i] = test[i].fillna(test[i].mode())\n","\n","\n"]},{"cell_type":"code","execution_count":10,"metadata":{"id":"qyCc4OrVJDsn","colab":{"base_uri":"https://localhost:8080/","height":237},"executionInfo":{"status":"error","timestamp":1642565695925,"user_tz":-480,"elapsed":472,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}},"outputId":"1af31f94-1238-4489-b87a-c936095cede0"},"outputs":[{"output_type":"error","ename":"NameError","evalue":"ignored","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mNameError\u001b[0m                                 Traceback (most recent call last)","\u001b[0;32m<ipython-input-10-e54635cb0125>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m()\u001b[0m\n\u001b[1;32m      7\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      8\u001b[0m estimators = [\n\u001b[0;32m----> 9\u001b[0;31m     \u001b[0;34m(\u001b[0m\u001b[0;34m'lgbm'\u001b[0m \u001b[0;34m,\u001b[0m\u001b[0mLGBMClassifier\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mn_estimators\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;36m5000\u001b[0m\u001b[0;34m)\u001b[0m \u001b[0;34m)\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m     10\u001b[0m     \u001b[0;34m(\u001b[0m\u001b[0;34m'xgb'\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mXGBClassifier\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m     11\u001b[0m    \u001b[0;31m# ('cat', CatBoostClassifier())\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;31mNameError\u001b[0m: name 'LGBMClassifier' is not defined"]}],"source":["#features= [\"Total Revenue\" , \"Satisfaction Score\" ,\"Tenure in Months\", \"Age\",\"Married\" ,\"Number of Dependents\" , \"Offer\" , \"Internet Service\",\"Payment Method\" , \"Longitude\" , \"pro\" , \"entertainment\"]\n","from xgboost.sklearn import XGBClassifier\n","from sklearn.ensemble import StackingClassifier\n","from sklearn.linear_model import LogisticRegression\n","from sklearn.neighbors import KNeighborsClassifier\n","from sklearn.multiclass import OneVsOneClassifier\n","\n","estimators = [\n","    ('lgbm' ,LGBMClassifier(n_estimators=5000) ),\n","    ('xgb', XGBClassifier()),\n","   # ('cat', CatBoostClassifier())\n","]\n","#clf = StackingClassifier(\n","#   estimators=estimators, final_estimator=LGBMClassifier())\n","#clf = CatBoostClassifier()\n","#clf = XGBClassifier()\n","clf = LGBMClassifier(num_leaves=10 , max_depth=9 ) \n","clf.fit(human_knowledge[features], human_knowledge[\"Churn Category\"])\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"qlhYRi2xE_9k","executionInfo":{"status":"aborted","timestamp":1642565695906,"user_tz":-480,"elapsed":448,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}}},"outputs":[],"source":["from sklearn.ensemble import ExtraTreesClassifier\n","from sklearn.feature_selection import SelectFromModel\n","feature_selection = ExtraTreesClassifier(n_estimators=50)\n","feature_selection = feature_selection.fit(human_knowledge[features], human_knowledge[\"Churn Category\"])\n","\n","model = SelectFromModel(feature_selection, prefit=True)\n","\n","X_new = model.transform(human_knowledge[features])"]},{"cell_type":"markdown","source":["# SVM"],"metadata":{"id":"VrtFbe4fXBOh"}},{"cell_type":"code","source":["from sklearn import svm"],"metadata":{"id":"sIj-3bntW_xy","executionInfo":{"status":"aborted","timestamp":1642565695909,"user_tz":-480,"elapsed":450,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["\n","\n","y_hat_svm =  clf.predict(test[features])\n","y_hat_svm"],"metadata":{"id":"OmxP3ImTOHeX","executionInfo":{"status":"aborted","timestamp":1642565695912,"user_tz":-480,"elapsed":453,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["show_res_count(y_hat_svm)"],"metadata":{"id":"Hd7e9YeHLdEr","executionInfo":{"status":"aborted","timestamp":1642565695914,"user_tz":-480,"elapsed":454,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["from sklearn.svm import LinearSVC\n","\n","clf2 = LinearSVC(random_state=1, tol=1e-5)\n","\n","clf2.fit(human_knowledge[features], human_knowledge[\"Churn Category\"])\n","y_hat_svm2 =  clf2.predict(test[features])\n","show_res_count(y_hat_svm2)"],"metadata":{"id":"jdfL4VZGgr43","executionInfo":{"status":"aborted","timestamp":1642565695916,"user_tz":-480,"elapsed":456,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["svm_clf = SVC(C=6.7046885962229785, cache_size=200, class_weight=None, coef0=0.0,\n","  decision_function_shape='ovr', degree=3, gamma=0.004147722987833689,\n","  kernel='rbf', max_iter=-1, probability=False, random_state=None,\n","  shrinking=True, tol=0.001)\n","svm_clf.fit(human_knowledge[features], human_knowledge[\"Churn Category\"])\n","y_hat_svm_clf =  svm_clf.predict(test[features])\n","show_res_count(y_hat_svm_clf)"],"metadata":{"id":"-e9nSGrZhgor","executionInfo":{"status":"aborted","timestamp":1642565695918,"user_tz":-480,"elapsed":458,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["from sklearn.model_selection import RandomizedSearchCV\n","from scipy.stats import reciprocal, uniform"],"metadata":{"id":"hndVyACMiNv1","executionInfo":{"status":"aborted","timestamp":1642565695919,"user_tz":-480,"elapsed":458,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["from scipy import stats\n","svm_clf2 = SVC(gamma=\"scale\")\n","# param_distributions = {\"gamma\": reciprocal(0.001, 0.1), \"C\": uniform(1, 10)}\n","\n","param_distributions = {'C': stats.expon(scale=100), 'gamma': stats.expon(scale=.1),\n","  'kernel': ['rbf'], 'class_weight':['balanced', None]}\n","rnd_search_cv2 = RandomizedSearchCV(svm_clf2, param_distributions, n_iter=100, verbose=2, cv=5)\n","rnd_search_cv2.fit(human_knowledge[features], human_knowledge[\"Churn Category\"])"],"metadata":{"id":"7HDiEXukiQ24","executionInfo":{"status":"aborted","timestamp":1642565695920,"user_tz":-480,"elapsed":459,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["rnd_search_cv2.best_estimator_"],"metadata":{"id":"nrbe6AWQmet0","executionInfo":{"status":"aborted","timestamp":1642565695921,"user_tz":-480,"elapsed":460,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["from sklearn.model_selection import cross_val_score\n","s = 0\n","scores = cross_val_score(rnd_search_cv2.best_estimator_, human_knowledge[features], human_knowledge[\"Churn Category\"], cv=5)\n","s+=sum(scores)\n","s"],"metadata":{"id":"AVHyhoVYo0ry","executionInfo":{"status":"aborted","timestamp":1642565695923,"user_tz":-480,"elapsed":461,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["y_hat_svm_rnd_search_cv = rnd_search_cv.best_estimator_.predict(test[features])\n","show_res_count(y_hat_svm_rnd_search_cv)\n"],"metadata":{"id":"DdiFGTOXjAQ7","executionInfo":{"status":"aborted","timestamp":1642565695924,"user_tz":-480,"elapsed":42,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["\n","t = sample_submission[\"Customer ID\"].to_frame()\n","\n","\n","t[\"Churn Category\"]= y_hat_svm.astype(int)\n","t = t.fillna(0)\n","t\n","t.to_csv(\"svm_ans.csv\", index=False)"],"metadata":{"id":"KmR4ik67X6bd","executionInfo":{"status":"aborted","timestamp":1642565695925,"user_tz":-480,"elapsed":43,"user":{"displayName":"fang willy","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"08439978241789894764"}}},"execution_count":null,"outputs":[]}],"metadata":{"colab":{"collapsed_sections":[],"name":"models_svm","provenance":[{"file_id":"1PXvNtI-trfqJ8vZFJLPSRQ0YeO1T-L6H","timestamp":1641384198754}]},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}